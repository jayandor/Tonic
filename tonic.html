<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tonic: Music Programming</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<body>
    <button id='play-button'>Play</button>
    <div id="soundStatus"></div>
    
    <script src="webaudio_tools.js"></script>
    <script src="MIDIUtils.js"></script>
    <script src="requestTimeout.js"></script>

    <script src="tonic.js"></script>
    <script src="tonic-decoder.js"></script>
    <script>
    // specific musical parameters

    var TEMPO    = 110,    // bpm
        TIME_SIG = 4;     // even numbers are duple, odd are triple, DOESN'T DO ANYTHING AT THE MOMENT

    var KEY = 'C#5';
    KEY = MIDIUtils.noteNameToNoteNumber(KEY);

    var notes_string2 =
    "\
    -17,2  \
    -12,1. \
    -12,1. \
    -12,1. \
    -12,1. \
    \
    -17,1. \
    -17,1. \
    -17,1. \
    -17,1. \
    \
    -14,1. \
    -14,1. \
    -14,1. \
    -14,1. \
    \
    -19,1. \
    -19,1. \
    -19,1. \
    -19,1. \
    "
    ;

    $.ajax({
        type: 'GET',
        url: 'smoke_on_the_water.notes',
        success: function (file_contents) {
            // success
            var notes = Tonic.common.notes_string_to_notes(file_contents, key = KEY, Tonic.scales.MINOR_PENT);
            //var notes2 = Tonic.common.notes_string_to_notes( notes_string2, key = Tonic.common.shift_octave(KEY, -1) );

            // Use audioContext from webaudio_tools.js
            var s1 = new Synth(audioContext, gain=0.05);
            var s2 = new Synth(audioContext, gain=0.17);

            var np = new NotePlayer(s1, notes);
            //var np2 = new NotePlayer(s2, notes2);

            var nc = new NoteController(TEMPO);
            nc.add_player(np);
            //nc.add_player(np2);

            var play_button = document.getElementById('play-button');
            
            play_button.onclick = function() {
                if (nc.PLAYING) {
                    nc.stop();
                } else {
                    nc.play();
                }
            };
        }
    });


    </script>
</body>
</html>